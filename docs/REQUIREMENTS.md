# 需求文档

## 1. 项目背景

### 1.1 项目愿景

构建一个**专业级占星计算与可视化系统**，将传统占星学知识与现代计算技术结合，提供：

- **精确的天文计算**：可追溯过去100年、预测未来100年
- **结构化的时间分析**：将人生划分为可理解的时间单元
- **量化的趋势输出**：将定性解读转化为可量化的分数
- **多端支持**：Web、移动端、智能体集成

### 1.2 核心理念

> 占星系统本质上是**时间对人产生影响的"索引器"**，不是因果引擎。
> 
> - 同样的"冥王星触发期"，有人离婚、有人创业、有人顿悟
> - 时间窗口一致，表现形式由现实条件和选择决定
> - 系统描述的是"什么时候浪大"，不是"是否该下水"

---

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 本命盘计算 (Natal Chart)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 行星位置计算 | 12颗天体（含北交点、凯龙星）黄道经度 | P0 |
| 宫位计算 | Placidus 分宫制，12宫位 | P0 |
| 相位计算 | 5种主要相位（合、六分、四分、三分、对分） | P0 |
| 图形相位识别 | 大三角、T三角、风筝、上帝之指等 | P1 |
| 元素/模式平衡 | 四元素、三模式分布 | P1 |
| 主导行星 | 识别命主星和主导行星 | P1 |
| 尊贵度计算 | 入庙、旺相、落陷、失势 | P1 |

**输入**：
- 姓名 (可选)
- 出生日期和时间 (必填，精确到分钟)
- 出生地点经纬度 (必填)
- 时区 (必填)

**输出**：
- 完整星盘数据（行星、宫位、相位、模式）
- 可视化 SVG 星盘图

#### 2.1.2 行运分析 (Transits)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 实时行运 | 当前天象与本命盘的互动 | P0 |
| 行运周期 | 指定时间范围的行运事件 | P0 |
| 重大行运识别 | 土星回归、天王星对冲等关键事件 | P0 |
| 个性化周期计算 | 基于本命盘位置的精确周期 | P0 |
| 行运时间线 | 可视化行运事件序列 | P1 |

**重大行运类型**：
| 行运 | 典型年龄 | 意义 |
|------|---------|------|
| 土星回归 | 29-30, 58-60 | 人生结构升级 |
| 土星对冲 | 14-15, 44-45 | 责任与挑战 |
| 木星回归 | 12, 24, 36... | 扩张与机遇 |
| 天王星对冲 | 40-42 | 中年觉醒 |
| 天王星四分 | 21, 63 | 突破与变革 |
| 海王星四分 | 41 | 灵性转化 |
| 北交点回归 | 18-19, 37-38 | 命运节点 |
| 凯龙回归 | 50-51 | 伤痛与治愈 |
| 推运月相回归 | 27-28 | 情感周期 |

#### 2.1.3 推运分析 (Secondary Progressions)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 次限推运 | 1天=1年 的推进计算 | P0 |
| 推运月相 | 推运太阳-月亮夹角 | P0 |
| 推运行星换座 | 推运行星进入新星座 | P1 |
| 推运相位 | 推运行星之间的相位 | P1 |

**月相周期**（约27.3年一周期）：
| 月相 | 角度 | 含义 |
|------|------|------|
| 新月期 | 0°-45° | 新开始、播种 |
| 新月后期 | 45°-90° | 行动、建设 |
| 上弦月 | 90°-135° | 危机、调整 |
| 凸月期 | 135°-180° | 完善、准备 |
| 满月期 | 180°-225° | 高峰、收获 |
| 播种期 | 225°-270° | 分享、传播 |
| 下弦月 | 270°-315° | 反思、释放 |
| 残月期 | 315°-360° | 整合、休息 |

#### 2.1.4 年限法 (Annual Profections)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 年度宫位 | 当前年龄对应的宫位 | P0 |
| 年主星 | 当年主事行星 | P0 |
| 年度主题 | 基于宫位的年度主题 | P0 |
| 人生轮盘 | 12年周期可视化 | P1 |
| 周期分析 | 第一/二/三轮周期分析 | P1 |

**宫位主题**：
| 宫位 | 名称 | 主题 | 关键词 |
|------|------|------|--------|
| 1 | 命宫 | 自我与身份 | 身份、外表、人格面具、生命力 |
| 2 | 财帛宫 | 资源与价值 | 金钱、物质、自我价值、天赋 |
| 3 | 兄弟宫 | 沟通与学习 | 沟通、学习、兄弟姐妹、短途 |
| 4 | 田宅宫 | 家庭与根基 | 家庭、根源、安全感、房产 |
| 5 | 子女宫 | 创造与表达 | 创造力、恋爱、子女、娱乐 |
| 6 | 奴仆宫 | 服务与健康 | 工作、健康、日常习惯、服务 |
| 7 | 夫妻宫 | 关系与合作 | 婚姻、合作、公开敌人、合约 |
| 8 | 疾厄宫 | 转化与共享 | 死亡重生、共享资源、心理深度 |
| 9 | 迁移宫 | 探索与智慧 | 高等教育、远行、哲学、宗教 |
| 10 | 官禄宫 | 事业与成就 | 事业、公众形象、成就、权威 |
| 11 | 福德宫 | 愿景与社群 | 朋友、团体、理想、希望 |
| 12 | 玄秘宫 | 内省与超越 | 潜意识、灵性、隐退、业力 |

#### 2.1.5 每日/每周预测

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 每日综合分数 | 当日整体能量评估 | P0 |
| 每日维度分数 | 事业/关系/健康/财务/灵性 | P0 |
| 月亮信息 | 月亮星座、月相、月空亡 | P0 |
| 每周概览 | 周度趋势和关键日期 | P0 |
| 行星时 | 每小时主星 | P1 |
| 最佳时机 | 适合特定活动的时间 | P1 |

#### 2.1.6 人生趋势 (Life Trend)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 80年趋势线 | 从出生到80岁的趋势 | P0 |
| 多维度分数 | 事业/关系/健康/财务/灵性 | P0 |
| 重大行运标记 | 人生关键节点标识 | P0 |
| 周期可视化 | 土星/木星周期展示 | P1 |

#### 2.1.7 统一时间序列 (Unified Time Series)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 多粒度切换 | H/D/W/M/Y 时间粒度 | P0 |
| 原始分数 | 无上限的原始计算值 | P0 |
| 标准化显示 | 0-100 归一化显示 | P0 |
| 因子分解 | 分数来源透明化 | P0 |
| 统计信息 | 均值、标准差、趋势 | P0 |
| 波动率 | 类似股票 ATR 指标 | P1 |

#### 2.1.8 影响因子系统

| 因子类型 | 描述 | 权重范围 |
|---------|------|---------|
| dignity | 行星尊贵度 | ±3 |
| retrograde | 逆行影响 | -2 |
| aspectPhase | 相位阶段（入相/离相） | ×0.8 |
| aspectOrb | 相位容许度精度 | ×0.5 |
| outerPlanet | 外行星周期 | ×1.2 |
| profectionLord | 年主星状态 | ×1.0 |
| lunarPhase | 月相影响 | ×0.7 |
| planetaryHour | 行星时 | ×0.3 |
| personal | 个人因子 | 可配置 |
| custom | 自定义因子 | 可配置 |

---

### 2.2 用户管理

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 用户创建 | 保存出生数据 | P0 |
| 用户列表 | 查看所有用户 | P0 |
| 用户更新 | 修改用户信息 | P0 |
| 用户删除 | 删除用户 | P0 |
| 用户快照 | 获取用户当前状态 | P1 |

---

### 2.3 智能体接口

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 上下文获取 | 获取所有用户的占星上下文 | P0 |
| 自然语言查询 | 回答占星相关问题 | P1 |

---

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 |
|------|------|
| 本命盘计算 | < 100ms |
| 每日预测 | < 50ms |
| 80年趋势 | < 500ms |
| API 响应 | P95 < 200ms |

### 3.2 精度需求

| 指标 | 要求 |
|------|------|
| 行星经度 | 误差 < 1° (100年范围) |
| 太阳位置 | 误差 < 0.1° |
| 月亮位置 | 误差 < 0.5° |
| 新月/满月 | 误差 < 6小时 |

### 3.3 可用性需求

| 指标 | 要求 |
|------|------|
| 服务可用性 | 99.9% |
| 数据持久性 | 用户数据不丢失 |
| 跨浏览器 | Chrome, Firefox, Safari, Edge |

### 3.4 安全需求

| 要求 | 描述 |
|------|------|
| 数据隐私 | 用户出生数据加密存储 |
| API 认证 | Token 认证（未来） |
| HTTPS | 生产环境强制 HTTPS |

---

## 4. 用户故事

### 4.1 普通用户

```
作为一个对占星感兴趣的用户，
我希望输入我的出生信息，
以便看到我的本命盘和人生趋势。

验收标准：
- 可以输入出生日期、时间、地点
- 可以看到星盘可视化
- 可以看到80年人生趋势线
- 可以切换不同时间粒度
```

### 4.2 进阶用户

```
作为一个有占星基础的用户，
我希望看到详细的行运和推运分析，
以便了解当前的时间能量。

验收标准：
- 可以看到当前行运相位
- 可以看到推运月相
- 可以看到年限法信息
- 可以看到影响因子分解
```

### 4.3 开发者

```
作为一个开发者，
我希望通过 API 获取占星数据，
以便集成到我的应用中。

验收标准：
- 完整的 RESTful API
- 详细的 API 文档
- JSON 格式响应
- 合理的错误处理
```

### 4.4 智能体

```
作为一个 LLM 智能体，
我希望获取用户的占星上下文，
以便提供个性化的建议。

验收标准：
- 可以获取用户当前状态
- 可以获取时间敏感的数据
- 可以用自然语言查询
- 响应格式适合 LLM 理解
```

---

## 5. 约束条件

### 5.1 技术约束

1. **无外部星历依赖**：使用内置算法计算，不依赖第三方星历服务
2. **前后端分离**：支持独立部署
3. **无数据库依赖**：内存存储，简化部署

### 5.2 业务约束

1. **非预测性声明**：系统不声称预测具体事件
2. **教育/娱乐用途**：定位为教育和娱乐工具
3. **个人使用**：暂不支持多用户协作

---

## 6. 未来规划

### 6.1 短期 (1-3个月)

- [ ] 数据库持久化
- [ ] 用户认证
- [ ] 移动端适配

### 6.2 中期 (3-6个月)

- [ ] 更多分宫制支持
- [ ] 小行星计算
- [ ] 中点计算
- [ ] 时辰推运

### 6.3 长期 (6-12个月)

- [ ] 合盘分析
- [ ] 选日功能
- [ ] 移动 App
- [ ] 多语言支持

