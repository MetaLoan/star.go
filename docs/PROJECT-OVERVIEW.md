# 项目概览

## 1. 系统定位

Star 是一个**结构化的占星计算与可视化系统**，核心理念是：

> 占星不是精确预测未来事件，而是一套用天象做时间坐标的叙事工具——描述**人生节律、主题切换和高概率事件窗口**。

### 1.1 核心特点

1. **确定性计算**：天体运动在 ±100~200 年尺度内高度可预测
2. **时间结构化**：将人生分解为多层时间结构（年/月/周/日/时）
3. **多系统融合**：整合行运、推运、年限法等多种占星技术
4. **量化输出**：将定性的占星解读转化为可量化的分数
5. **个性化计算**：所有计算基于用户精确的本命盘数据

---

## 2. 技术架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                           客户端层                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │
│  │  Web 前端   │  │  移动端     │  │  智能体     │                  │
│  │  (Next.js)  │  │  (Future)   │  │  (LLM)      │                  │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                  │
└─────────┼────────────────┼────────────────┼─────────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           API 层                                     │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                    RESTful API (Go + Gin)                     │   │
│  │  /api/calc/*     计算接口                                     │   │
│  │  /api/users/*    用户管理                                     │   │
│  │  /api/agent/*    智能体接口                                   │   │
│  └──────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          计算层                                      │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐           │
│  │  天文计算引擎   │ │  占星算法      │ │  影响因子系统   │           │
│  │  - 儒略日转换   │ │  - 本命盘      │ │  - 尊贵度       │           │
│  │  - 行星位置     │ │  - 相位计算    │ │  - 逆行         │           │
│  │  - 宫位计算     │ │  - 行运        │ │  - 行星时       │           │
│  │  - 月相计算     │ │  - 推运        │ │  - 月相         │           │
│  │                │ │  - 年限法      │ │  - 自定义       │           │
│  └────────────────┘ └────────────────┘ └────────────────┘           │
│                              │                                       │
│                              ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                   统一时间序列系统                            │   │
│  │  最小粒度: 小时 → 聚合: 日 → 周 → 月 → 年                      │   │
│  │  原始分数(无上限) → 标准化显示(0-100)                          │   │
│  └──────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          数据层                                      │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐           │
│  │  用户数据       │ │  星历参数       │ │  配置数据       │           │
│  │  - 出生信息     │ │  - 行星轨道     │ │  - 因子权重     │           │
│  │  - 偏好设置     │ │  - 相位定义     │ │  - 显示选项     │           │
│  └────────────────┘ └────────────────┘ └────────────────┘           │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈

#### 后端 (Go)
| 技术 | 版本 | 用途 |
|------|------|------|
| Go | 1.21+ | 主要开发语言 |
| Gin | 1.9+ | Web 框架 |
| - | - | 无外部数据库依赖 |

#### 前端 (TypeScript/React)
| 技术 | 版本 | 用途 |
|------|------|------|
| Next.js | 15.x | React 框架 |
| React | 19.x | UI 库 |
| HeroUI | 2.x | 组件库 |
| TailwindCSS | 3.x | 样式框架 |
| Framer Motion | - | 动画库 |

---

## 3. 目录结构

### 3.1 Go 后端 (Star.go/)

```
Star.go/
├── main.go                    # 应用入口
├── go.mod                     # Go 模块定义
├── go.sum                     # 依赖锁定
├── Makefile                   # 构建脚本
├── Dockerfile                 # Docker 配置
├── README.md                  # 项目说明
│
├── api/                       # HTTP API 层
│   ├── routes.go             # 路由定义
│   └── handlers.go           # 请求处理器
│
├── astro/                     # 占星计算核心
│   ├── constants.go          # 常量定义（行星、星座、相位）
│   ├── ephemeris.go          # 天文星历计算
│   ├── aspects.go            # 相位计算
│   ├── natal_chart.go        # 本命盘计算
│   ├── transits.go           # 行运计算
│   ├── progressions.go       # 推运计算
│   ├── profections.go        # 年限法计算
│   ├── forecast.go           # 每日/每周预测
│   ├── life_trend.go         # 人生趋势计算
│   ├── influence_factors.go  # 影响因子系统
│   ├── data_processor.go     # 数据处理器
│   └── unified_score.go      # 统一分数系统
│
├── models/                    # 数据模型
│   └── user.go               # 用户模型
│
└── bin/                       # 编译输出
    └── star-api              # 可执行文件
```

### 3.2 Next.js 前端 (Star/)

```
Star/
├── package.json               # 项目配置
├── next.config.js            # Next.js 配置
├── tailwind.config.js        # Tailwind 配置
├── tsconfig.json             # TypeScript 配置
│
├── docs/                      # 文档目录
│   ├── README.md             # 文档索引
│   ├── PROJECT-OVERVIEW.md   # 项目概览
│   ├── REQUIREMENTS.md       # 需求文档
│   ├── ALGORITHMS.md         # 算法文档
│   ├── API.md                # API 文档
│   ├── DATA-STRUCTURES.md    # 数据结构
│   ├── FRONTEND.md           # 前端文档
│   └── DEPLOYMENT.md         # 部署指南
│
├── src/
│   ├── app/                   # Next.js App Router
│   │   ├── layout.tsx        # 根布局
│   │   ├── page.tsx          # 首页
│   │   ├── globals.css       # 全局样式
│   │   ├── providers.tsx     # 全局 Provider
│   │   │
│   │   ├── api/              # API 路由 (可选，主要用 Go 后端)
│   │   │   ├── calc/         # 计算接口
│   │   │   ├── users/        # 用户接口
│   │   │   └── agent/        # 智能体接口
│   │   │
│   │   └── ssr/              # SSR 示例页面
│   │
│   ├── components/            # React 组件
│   │   ├── chart/            # 星盘组件
│   │   │   ├── NatalChartSVG.tsx   # 星盘 SVG 渲染
│   │   │   └── ChartInfo.tsx       # 星盘信息面板
│   │   │
│   │   ├── timeline/         # 时间线组件
│   │   │   ├── LifeTimeline.tsx    # 人生趋势线
│   │   │   ├── UnifiedTimeline.tsx # 统一时间序列
│   │   │   └── ProfectionWheel.tsx # 年限法轮盘
│   │   │
│   │   ├── forecast/         # 预测组件
│   │   │   ├── DailyForecastView.tsx  # 每日预测
│   │   │   └── WeeklyForecastView.tsx # 每周预测
│   │   │
│   │   ├── factors/          # 影响因子组件
│   │   │   └── InfluenceFactorsPanel.tsx
│   │   │
│   │   └── input/            # 输入组件
│   │       └── BirthDataForm.tsx  # 出生数据表单
│   │
│   └── lib/                   # 核心库
│       ├── api/              # API 客户端
│       │   ├── client.ts     # HTTP 客户端
│       │   ├── hooks.ts      # React Hooks
│       │   └── server.ts     # SSR 数据获取
│       │
│       ├── astro/            # 占星计算 (TypeScript 版本)
│       │   ├── constants.ts
│       │   ├── ephemeris.ts
│       │   ├── aspects.ts
│       │   ├── natal-chart.ts
│       │   ├── transits.ts
│       │   ├── progressions.ts
│       │   ├── profections.ts
│       │   ├── daily-forecast.ts
│       │   ├── life-trend.ts
│       │   ├── influence-factors.ts
│       │   └── data-processor.ts
│       │
│       ├── services/         # 业务服务
│       │   └── user-service.ts
│       │
│       └── types/            # 类型定义
│           ├── index.ts
│           └── user.ts
│
└── scripts/                   # 工具脚本
    ├── verify-positions.ts   # 行星位置验证
    └── debug-*.ts            # 调试脚本
```

---

## 4. 数据流

### 4.1 计算流程

```
用户输入出生数据
        │
        ▼
┌───────────────────┐
│  1. 本命盘计算     │
│  - 计算儒略日      │
│  - 计算行星位置    │
│  - 计算宫位        │
│  - 计算相位        │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  2. 时间敏感计算   │
│  - 行运计算        │
│  - 推运计算        │
│  - 年限法          │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  3. 分数聚合       │
│  - 小时级计算      │
│  - 向上聚合        │
│  - 因子调整        │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  4. 输出处理       │
│  - 原始分数        │
│  - 标准化显示      │
│  - 维度分解        │
└───────────────────┘
```

### 4.2 API 调用流程

```
前端                           后端
  │                              │
  │  POST /api/calc/chart        │
  │  { birthData }               │
  │─────────────────────────────>│
  │                              │ 计算本命盘
  │<─────────────────────────────│
  │  { planets, houses, ... }    │
  │                              │
  │  POST /api/calc/time-series  │
  │  { birthData, granularity }  │
  │─────────────────────────────>│
  │                              │ 生成时间序列
  │<─────────────────────────────│
  │  { points, stats }           │
  │                              │
```

---

## 5. 部署模式

### 5.1 开发模式

```bash
# 终端 1: Go 后端
cd Star.go && ./bin/star-api

# 终端 2: Next.js 前端
cd Star && npm run dev
```

### 5.2 生产模式

```bash
# Docker 部署
docker build -t star-api ./Star.go
docker run -p 8080:8080 star-api

# 前端可部署到 Vercel
cd Star && vercel
```

---

## 6. 版本历史

| 版本 | 日期 | 主要更新 |
|------|------|---------|
| 1.0.0 | 2026-01 | 初始版本：本命盘、行运、推运、年限法 |
| 1.1.0 | 2026-01 | 添加统一时间序列系统 (H/D/W/M/Y) |
| 1.2.0 | 2026-01 | 添加影响因子系统 |
| 1.3.0 | 2026-01 | 个性化重大行运计算 |

